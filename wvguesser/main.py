from pathlib import Path
from wasmer_compiler_cranelift import Compiler
from wasmer import wat2wasm, engine, Store, Module

from wvguesser.wasm_helper import Instance


wasm = wat2wasm(Path('wvguesser/wasm_gsr.wat').read_text(encoding='utf-8'))
# wasm = Path(r'wvguesser/wasm_gsr.wasm').read_bytes()
# 初始化一个存储器
store = Store(engine.JIT(Compiler))
# 载入wasm
module = Module(store, wasm)
# 初始化实例 内存+模块+外部导入函数
instance = Instance(module, store)
hex_session_key = '67d1d28cc45b762cc4ed54c3ab7abd1c43059b2df82ec05b911e45f73ba8875dbf72870aa684c8cf84946f434236325f5763f53408e9aea528f224c38ad60b83992d16a5f3d4922a99f09002b7e9d1d3a3749b21dee05cd90e54e519dd2c63969c4f60890cbfcbb17a40a82dc922fd4fff5443d7484242c30537972ab0f96a20ac8a77d463bd46337888399bddc1b52efeeba2211a575778f74381dbe0aa19619b227693d32cc8fb065e9686a4b096f865af3ac755e34330343eb7fbb993763ea103d558bfb49a26adfa3a8e05ef5b49ac9461bfcdb2db8afefd1ba28c023c8f8c36381f39509f84acc8bc215dea58d08a8bd8a84fa62925fd026febeb03371b'
context_enc = '01454e4352595054494f4e0012530a510a3b08011210eb676abbcb345e96bbcf616630f1a3da1a0d7769646576696e655f746573742210666b6a336c6a61536466616c6b72336a2a024844320010011a101ec528de8f25ee5e07044e0ff78f428f180120a4dc8e8806301538cbc8dff20642ee1e0a1273746167696e672e676f6f676c652e636f6d121028703454c008f63618ade7443db6c4c81ab01cd517cd577c0de1c1dd16d0781babc1b09c4a1ae1006153af95df66729d72b52727255b24696cf6c8fe76de1124fcc22e64a0a0cfd37c9c52a17df29cf1ac0848261e94218209870c39422ab0549593e3dd474919ee58980bebdf77b1b31e776a11015d26d72dfac576cc29fe06def22783bd218ba4c4ec017067885c198f2c95a10ad3b51ffe0b1434969d4f78149758fc58a89f52d780989a81185c203e8b728cc27c34d6771a080f981abe59a30f56a97a878e19e37b86bf43b52796dd7fc49d753dbb7b4a8dcd57a2295439af15eebf4d31cbe37605494460a6b3c0b921af0d260052419a7010226379c389a19bb5549dc2016b45395da6e238a801ab5e43609d1648a88f3c9d9399a11965e67d681996389efa7a2c8282845438bebebc02a5c7eeb02c8aac93c1aad0dab7a9ca0b8a9a6502c2b433329fa5fa49ea0da5df9ce564e5b24120fe86934e5abf24977c9357f995306c721e16246d3059654c5cf8cf3dd11b2a4c57fe6c73c1182965bd5e96ee4ac87c46e24b0d3593f9610d0a1316276701839b10f43f682e4a86c00a3eb461d1bc80503f18d38c7c3b6ed8ca5e58a93838f78bdbd51e4fdaeadb070ecc3660f9392d1368c3c2dabe01844d846252cb51f620d23d13b7288cc677b1cfd6a31a181b68da136bcb31cd50d0971335bf63d65142e141858c0bd1173d9b8e3309273c0c17a6d1f47d020c2680377c80f52f50f464e20b94e13ecf17ae9476de70335d38f6e26185d1a694cccad40eb8e4083a5498f82c74fc293f582f8f33db1dd64fbc46fc7034be5b1b04f4625b44932555986aa828da11d89cccde1aec02a159533b2b8e08168a288e9e2f6ea7dda21a4ae999dab0630ab0383dedf708925cd4113b3fe4581a4deacc13cf298d67462c7f241e5aed9aaec68d09d055396e0e3a25dfaaf1a573f6b46d1a2a9ee655033a0406787a29a9ae61afabcfe97377104bec9000bfa0c4b124e2281307e1ddad4fd9f78616eb0d93eb29c14b63d729bb928763066643d5482d7991f468eaba1b576c86b0cd151e7b22731b133f412eeb196bb7635e91cca9da0cf07ace24867e3541026f5e704c901f4b91e99cb40122f5e6fe8d675f00e265e24e82741d9f40ce2624f3701f630cebc5ae27d81dd219c5be82f7fe72a2fd2fe5f684f0ece1c7fb49fc4a68d7716b456a83e88bf68a9536103922e5033bc1d75c8979d5fb9ca6f37b4cebef3ac05ee0cc9210ab3f1de65b85de7249568208d7519dea5879f74f576d5c83762e15df4746a771c1536d92975d2b85923930c3eda55c60127ec98e68b1152943660b0d86d1091d0bab04ccc179c416bc6603fc41cc302197f5174f58151aec3aaf8d308740e266758d5ca447e286791b96665cea90c37efac1c0e74e002a1803c0d1d4608afabbba75933e39e29c474e95cee7af07371ba2beaa804ad86ea3a660e0c1870722a0674396ca66e884dfbf70067bc93c89534eabab6a99625bcfc27e553074a7c06a1d32db6870a152bb0ba2901079694add29881bd0d5a0b58992f63fc5083c66dd4e9143f3627408f0c5dc7f68ae5c84dc74c7e1540ed90c06dbdccc36147304182df638370e6562d5610c24921888e189ea5c5d39aa516c79ac7a4bdc4d7f698687e88fb9092952e8f27ee9b09c0fefaf609f194004c310b5ef3f33e090b1d7934b9dbd717c051b041249d07e86fbdb2da1f99d0f9e16f4e4fcc0408d0dc82a7dc69535efee24d3b8b5fddcc2ed3162bbd07faa73d92a5607115fc2060ad27dd134ed6aeab881bdf1dead6b550c13b368c145e889de889e3c137847fd4cadb290a4e4c777eee4544cef547b15d57a2e15e9ae37df74f69d212b344639a1b839bdafce616ff30b405427ba0996a45c7a657200628fa337dd09ff12c0af7b31de7e7cbbc4cc4356130dd0f1b3b362e85c3eaebe982d795ecea8ec24d129bc12b43ede153aba98234175d482ba7536aa9c3dfaac384a3e0977f9ef5090e47354108f41a625cca69c2b19fe4be988e0e8d758e833083ca29d3872a5bcb9fd1aea3c4bd86842d2f542473d83178c4e830ba97eef7bc4f011bd0c5af58fd057809c001ee43c758380fe2e77a0f7ed5d97f9fa983bcc0f0dd1f594b10923ea966c75db47e987775f16ee752ac544b4f30e2f581eadc1f00dfd9379f0b825007c808069a8ebcce236f4d222694b5552674d548a6056cc659ad937ed51ca78915e1aa62654907acd206c67aa0e478afe8c094627013f2075498188943beebcd7dcff4d226df5f65a5e02197b42ab2a05872f8c0a6868ab3d9dac0b57e11298d3ff51407e6854fece1b89cd6af4ab188d79bc9c4305ee50470d6a080610bddd097319138e35ab28bd80d44d9b7e3d75340b1690e1696e6cce49c0ea98e0d329eff3adbf153e7ce9acf17a8803bd4f51ccf6b2f8d56d9113fce82f6e857a8bdd325f973b9a63062185a7e13f399ac7ac1ca92fc25b72009cbfe181b8eb9d1e15b82b9eceea4e5edba70588bc42fa6ee9587382122976072911b04ecb7a22aaec5b022b80bafdb487c872f4a80b65058594502d7a16b5dbed4307ddfd7bdd030d800bd04b468ecdb9812e4275322a7c088f22af7eba41a60d4398ca38de8ee452a9ff86eeea0b21f274c4f867940a1971b50c628ff2244ff76f0f329f40628b5ea011bab421e2b54d65f91359244c51e8450eefb4b9d51ecae8091c08dc0655a4629d22f59f2eeebcda27411f3b9765211cb0981a7729f61d7c7699421ac21de64253aa678db1963c30162ad3bdef893c080b358bc4ddc8be0aa8abc9f68a633f314605aaabbc18b91b2995a4a03157e944133cd82e13389b0a194f008d2c8d6cc14f14dd11e53c370aca82e71da7a79f0ccf05d8e6610373a7856381031edc614f1162d53b836482f8f8c2195d1818fe257a752e9f8e9451d8530d9ac028f36af0dec2f25c630d6bea22a0245e8e02f48b911a7ad6e0968b4dfe3f2407ba794224ccbb425be2064ba0b973dcac50cedbbca3496e2ec501817463a9aad796b27a7c09031ac506dcf4f6ba10c9f79cf530a7f6b38ce6ea4645d3fb3596a04033397ed9ab0130e4043f4396dc5e257031e3511e4b034a8139d5ef8d52fa45bf5d3b3b3b9b03b8980b0a962101818f5cb773f8b6805025c7d0696f716fd49566c750761d2df681dc8fe235b45d9a566d421f2f20e2d208d3c2bd58939b4a3bd6d94d4d5857533f5de9a3afc4f5d30fb209549404ab77832594b329bad30d68d734f149fa1174507e363c91ebea8c9c8edae1fe246c1685ff1a54c0828e90143ff7e3a581d888a4c698707a6eb0d0eb9b44b32cde86e85e182646dfde47b671138fb2c07e34a8d03ffab15956af2ddf1e633019f43180128c706dea0bca4f1cc327acbc68328704d9fc280dd3336c047e65b887b3103bacd5408dd0ca45b521be055e56538d07d06fa7954cc9b8de72360d01ba9648eace2ca90a2b8961e47bf5cee3cb79ab37f69b404aa4a36b19c187951d4bd56ad5a5d32e9ee0a2f2be4117e83f681ed94fd487714063598fef5d5ffa123287f3532e0601af8e3a7350719590aff93b59a8eace6745f2164814d32b6c7e2d9faddde987d4b511e450c5c42a602fe7404abb81978fbed826584752733017391d921069eb4b8ceb2f19d2be6fc07beaaf8760ce1ac047bec11a46d76ff795f9ac0a3fd1c334e4ebd2f23bc1811c51ea607cdfb068dd3e59e333088d22338cb7adf5bcd37c9f175080107966dcec54e3540f9c129afbca9f10d598628d2ce7150a59f202fc568c72e263492b6968800fbebb7c56214fb3d12b300f4493c5e67e8830a8ed4dffbdd59aa20937c0bb7227c03bab6acb96ebee14511459f77ef95664c04349ab4c1d5789af0edf086a54c7b640b2da63b19f3bf89c745c9161e2fafce61df9d170be6a24caac684664072f4e8b0d854f92e94e0791bc2291cb2cb0a77e5e80339c20bf1586e46889a603c3e4e5491c2d4f4808ffafa75220ac22e586278a230c7c682a2b40a5caa706ce5badcb01a142a9f2836c51e47c47f028a9049c643fc929859316da4aca8b13c0177241feff0c45cd37463182d67be8b50c93c51dc0647c6b3d958727bb004d91bea0ac83ecae4af455ca553d34e135fabbfdbfe3d6661b32776633bb00f8d6fd9e4cb8033aad8c9f74009e318489540e529ffa505cc5b74b6f4884e5e33c73e6e7ab71123ca452cf06d0e860edb0b32e3bafa91c821fba69caec0997087fac5ee10e29ffd5f0542a9c474f1710403e1d08dfffb546c78e48d8055a88365f31af68c43269664d120908ea7a84b621398ab8d0298acb6637283d3a98c60fb47eda5ba09ee9085e973b0b918c1fe936d9a61b01f7354a66bca9966184561f8e63822a21bdfeff0e9a924a701531257c64e6469819811a04ccd71621512c9bd8edc5f61672faa27f893df19c403811334ca8c4166e04c9d1a1da8a55ff42e722298e4c6a8d26326d9c16fc849731c45012960d4dba043fde97f0886466ec7965a67d548b6b7341588ee53b419becb90bd9e4f7d465a78e01f08b9fec246d27b7f882027e642031709ff21eaccd343c47d243d283d6e21d9f0c502407709ef8a054d2a6871af563b6c37888b156a898cd24e1a0d38dde756c0d1ca554b76145d8d090c58c3dbffa84e436f5d158fdf10820f7b1e1e240c091c4b699843ac4d58abb3605c3d561f610ac8eb88310768ea5cecbed4dcd01aac32ce584617988877fc2daa8e6299aa04601cb0427f5f881f3359b84355c27d182ebf9b8872e3d5e3421320b37c0e32de827c829a7c89d0e2892dcdc27b8e76a0da0b8f36d52dafc9b43a480383e1276b18a752797748f0010e87abbb7327d97ff84d38897700d9335fc33b7171045745fc1c3953b01157cd833c72cac47966772ae12e9ea7bfa4fc141d6537eb91779130b897faf1b814f3731ec0e2b7623348e3132cae0076a4a01586839a26a3a1c45c907e3ccac85a99f9f8a46168642c5073771446b983f8d1ecec71211d91f16c430afe011650ef07246bbebb912ddae66da6e327f786e2bbc5052a08e0f482caf524a4d0de7a567550ea2e6eec64708c41b184a4215972f3ac0f272386d72243fe94a221023156209f09e10d87f5d74b65128a7862a800280ae0c58885580f3f31ecae13683466214232e7ce45c4aec04a3c24d2412179e3d2661c77846f2b676e84761713c396cbebd6edc49f84d7360c6db583bf1745bf4b31d9a6df9576aa9d276c7dd0adefeb7434b3673cc0f184895b8eda18bfc86cbab55847993e7151e6d0834d90107be9d339bcf0fdff29aca57c7863c48a6c3aafa0f67ae8290c689e3869a2ddfbb549188028cc95d7e538634dcdbe9f9ebffb382cf1edb6175c93137f1b632226ebc6268ea917b97eaf313a725f6f3a8c236f6a30901f374cf24b012008f15cff19270f3c8feaf2a767f7f836556849c60509478e83a80dab1384bd0487e7ac2b95bf4504fe15fb307f4f3915d761ed064c900000080'
key_infos = {
    "0": [
        "eb676abbcb345e96bbcf616630f1a3da",
        "43f49780e3c48a1eb7812c685c108f03",
        "9c54fbd6adeef278ddf90207efac11c5"
    ],
    "1": [
        "0294b9599d755de2bbf0fdca3fa5eab7",
        "da7b3d2a5455c010f1f23368cbd622d6",
        "54b3b5590337b6e7339de910bec90ef5"
    ],
    "2": [
        "639da80cf23b55f3b8cab3f64cfa5df6",
        "0ea4023ef89738f4a77e498342b67e6e",
        "261fe6e6b9c3ce6c4aa97309559ba646"
    ]
}
clear_session_key = instance.run(hex_session_key)
instance.decrypt_license_keys(clear_session_key, context_enc, key_infos)

# python -m wvguesser.main